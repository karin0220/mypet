<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- PCì—ì„œ ì—´ì–´ë„ ëª¨ë°”ì¼ì²˜ëŸ¼ ë³´ì´ë„ë¡ ë·°í¬íŠ¸ ê³ ì • -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ì¤Œ ì•± - ë©”ì¸ ë¯¸ì…˜ ê°œí¸ì•ˆ</title>
  
  <!-- Pretendard Web Font -->
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
  
  <!-- React & Tailwind -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- NOTE: Babel for JSX compilation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Lucide Icons (Latest) -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- TailwindCSSì™€ ê¸°ë³¸ Body ìŠ¤íƒ€ì¼ë§Œ ìœ ì§€ -->
  <style>
    body {
      font-family: 'Pretendard Variable', Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
      margin: 0;
      overflow-x: hidden;
      background-color: #F0F2F6;
      /* ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ ì‹œ íŒŒë€ ë°•ìŠ¤ ëœ¨ëŠ” ê±° ë°©ì§€ */
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    // --- Robust Icon Component ---
    const Icon = ({ name, size = 24, color = "currentColor", className, ...props }) => {
      const iconName = name
        .split('-')
        .map(part => part.charAt(0).toUpperCase() + part.slice(1))
        .join('');

      const lucideGlobal = window.lucide;
      if (!lucideGlobal || !lucideGlobal.icons) {
        return null;
      }

      const iconDef = lucideGlobal.icons[iconName];
      if (!iconDef) {
        return null;
      }

      return (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size} 
          viewBox="0 0 24 24"
          fill="none"
          stroke={color}
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
          {...props}
        >
          {iconDef.map((child, index) => {
            const [tag, attrs] = child;
            return React.createElement(tag, { ...attrs, key: index });
          })}
        </svg>
      );
    };

    const App = () => {
        // [1. CSS Styles in JS]
        React.useEffect(() => {
            const styleTag = document.createElement('style');
            styleTag.innerHTML = `
                /* PCì—ì„œ ëª¨ë°”ì¼ í™”ë©´ì²˜ëŸ¼ ë³´ì´ë„ë¡ ì•± ì»¨í…Œì´ë„ˆ ì¤‘ì•™ ì •ë ¬ */
                #root {
                    display: flex;
                    justify-content: center;
                    background-color: #F0F2F6;
                }
                .shadow-inner-custom {
                    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06), inset 0 -2px 4px rgba(255, 255, 255, 0.5), 0 4px 6px rgba(0, 0, 0, 0.1);
                }
                @keyframes fade-in {
                    from { opacity: 0; transform: translateY(5px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .animate-fade-in {
                    animation: fade-in 0.3s ease-out forwards;
                }
                @keyframes scale-in {
                    from { opacity: 0; transform: translate(-50%, 10px) scale(0.5); }
                    to { opacity: 1; transform: translate(-50%, 0) scale(1); }
                }
                .animate-scale-in {
                    animation: scale-in 0.3s ease-out forwards;
                }
                @keyframes squish {
                    0% { transform: scale(1); }
                    40% { transform: scale(1.05, 0.92) translateY(2px); }
                    70% { transform: scale(0.95, 1.05) translateY(-2px); }
                    100% { transform: scale(1); }
                }
                .animate-squish {
                    animation: squish 0.3s ease-in-out;
                }
                @keyframes coin-fly {
                    0% { 
                        opacity: 1; 
                        transform: translate(-50%, -50%) scale(0.8); 
                        top: 45%; 
                        left: 50%;
                    }
                    20% {
                        transform: translate(-50%, -50%) scale(1.2); 
                    }
                    90% {
                        opacity: 1; 
                    }
                    100% { 
                        opacity: 0; 
                        transform: translate(0, 0) scale(0.4); 
                        top: 32px; 
                        left: 32px; 
                    }
                }
                .animate-coin-fly {
                    position: absolute;
                    z-index: 50;
                    animation: coin-fly 0.8s ease-in-out forwards;
                    pointer-events: none;
                }
                /* í•˜íŠ¸ ì• ë‹ˆë©”ì´ì…˜ ìˆ˜ì •: ë” ë„“ê²Œ í¼ì§€ê³  ëŠ¦ê²Œ ì‚¬ë¼ì§€ë„ë¡ ì¡°ì • */
                @keyframes heart-pop {
                    0% { opacity: 1; transform: translate(-50%, 0) scale(0.5); }
                    50% { opacity: 1; transform: translate(-50%, -60px) scale(1.2); }
                    100% { opacity: 0; transform: translate(-50%, -100px) scale(0.7); }
                }
                .animate-heart-pop {
                    animation: heart-pop 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
                    position: absolute;
                    pointer-events: none;
                }
            `;
            document.head.appendChild(styleTag);
            return () => { document.head.removeChild(styleTag); };
        }, []);

      
      const [selectedImage, setSelectedImage] = React.useState(null);
      const [generatedImage, setGeneratedImage] = React.useState(null);
      const [isLoading, setIsLoading] = React.useState(false);
      const [error, setError] = React.useState('');
      const [isPetConfirmed, setIsPetConfirmed] = React.useState(false);
      
      // [ìµœì¢… ìˆ˜ì •]: AI ê·¸ë¦¼ì/ë°°ê²½ ì œê±°ë¥¼ ìœ„í•œ í”„ë¡¬í”„íŠ¸ ê·¹ë”œ + ì—¬ë°± ì¶”ê°€ ìš”ì²­
      const promptStyle = 'A full-body, centered, 3D cute character, rounded, smooth, plush texture, soft studio lighting, with large padding around the character. The character must be fully isolated on a flat pure white background, with NO shadows at all, or any kind of external lighting effects. Ensure the character is completely cut out and fills most of the frame. Single subject only, digital art style. lighting is flat and even on the character, but the background is rendered as a pure, uniform white, completely devoid of any light source, shadow, or gradient.';
      
      const fileInputRef = React.useRef(null);
      const petImgRef = React.useRef(null); 
      const lastTouchTime = React.useRef(0); 
      const COUNT_DEBOUNCE_MS = 700; 

      // ë¡œë”© ì™„ë£Œ í›„ ì²˜ë¦¬ í•¨ìˆ˜ (ì´ë¯¸ì§€ í‘œì‹œ ë° ìƒíƒœ ë¦¬ì…‹)
      const handleFinalize = (result) => {
          setIsLoading(false);
          
          try {
              if (result.error) {
                  console.error("API Error:", result.error.message);
                  // ì„œë²„ì—ì„œ ì˜¨ ì—ëŸ¬ëŠ” ê¹”ë”í•˜ê²Œ ì²˜ë¦¬ (ìœ ì¶œ ê²½ê³  ì—†ìŒ)
                  setError(result.error.message || 'ğŸš¨ ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨. ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                  return;
              }
              
              const generatedImageBase64 = result.data;
              if (generatedImageBase64) {
                // [ìˆ˜ì •]: ì´ë¯¸ì§€ í˜•ì‹ì„ PNGë¡œ ë³€ê²½ (íˆ¬ëª…ë„ ì§€ì›)
                setGeneratedImage(`data:image/png;base64,${generatedImageBase64}`);
                setIsPetConfirmed(false); 
              } else {
                throw new Error('ì„œë²„ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
              }
          } catch (err) {
              console.error(err);
              setError(err.message || 'ì´ë¯¸ì§€ ìƒì„± ì²˜ë¦¬ ì¤‘ ì—ëŸ¬ ë°œìƒ');
          } 
      };

      const resizeImage = (file, maxWidth = 1024, maxHeight = 1024) => {
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              let width = img.width;
              let height = img.height;
              if (width > maxWidth || height > maxHeight) {
                if (width > height) {
                  height = Math.round((height * maxWidth) / width);
                  width = maxWidth;
                } else {
                  width = Math.round((width * maxHeight) / height);
                  height = maxHeight;
                }
              }
              canvas.width = width;
              canvas.height = height;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, width, height);
              // [ìˆ˜ì •]: toDataURLì„ PNGë¡œ ë³€ê²½ (íˆ¬ëª…ë„ ì§€ì›)
              resolve(canvas.toDataURL('image/png'));
            };
            img.src = e.target.result;
          };
          reader.readAsDataURL(file);
        });
      };
      
      const processFile = async (file) => {
        if (!file.type.startsWith('image/')) {
          setError('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì˜¬ë ¤ì£¼ì„¸ìš”.');
          return;
        }
        setGeneratedImage(null);
        setIsPetConfirmed(false); 
        setError('');
        
        try {
          setIsLoading(true);
          const resizedDataUrl = await resizeImage(file);
          setSelectedImage(resizedDataUrl);
          setIsLoading(false); 
        } catch (err) {
          setError('ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨');
          setIsLoading(false);
        } 
      };


      const generateAIImage = async () => {
        if (!selectedImage) return;

        setIsLoading(true); 
        setError('');
        
        try {
            // [ìˆ˜ì •]: data:image/png;base64, ë¡œ ì‹œì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  base64 ë°ì´í„° ì¶”ì¶œ
            const base64Data = selectedImage.split(',')[1];
            
            const response = await fetch(
              // Vercel Functionì˜ ê²½ë¡œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. (ìë™ìœ¼ë¡œ ì„œë²„ì˜ í™˜ê²½ë³€ìˆ˜ í‚¤ ì‚¬ìš©)
              '/api/generate',
              {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  // í‚¤ëŠ” ë³´ë‚´ì§€ ì•Šê³ , í•„ìš”í•œ ë°ì´í„°ë§Œ ì„œë²„ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
                  base64Image: base64Data,
                  prompt: promptStyle,
                  mimeType: 'image/png' 
                })
              }
            );
            
            const result = await response.json();
            handleFinalize(result); 
        } catch (err) {
            handleFinalize({ error: { message: `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${err.message}` } });
        }
      };


      const handlePetAreaClick = () => {
        if (!selectedImage && !isLoading) {
          fileInputRef.current?.click();
        }
      };

      const handleConfirmPet = () => {
        setIsPetConfirmed(true);
        setPetMessage('í« í™•ì •! ì´ì œ ë§ˆìŒê» ì“°ë‹¤ë“¬ì–´ì¤˜! â¤ï¸');
      };

      const handleRerollPet = () => {
        if (isLoading) return;
        setPetMessage('ê´‘ê³  ì‹œì²­ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤!');
        generateAIImage(); 
      };
      
      const [touchCount, setTouchCount] = React.useState(0);
      const [showReward, setShowReward] = React.useState(false);
      const [petMessage, setPetMessage] = React.useState('ì•ˆë…•? ë‚˜ë‘ ë†€ì!');
      const maxTouchCount = 12;
      const [showCoin, setShowCoin] = React.useState(false);
      const [points, setPoints] = React.useState(10419);
      const [hearts, setHearts] = React.useState([]);

      const randomMessages = [
        "ë‚  ë§Œë“¤ì–´ì¤˜ì„œ ê³ ë§ˆì›Œ! ğŸ¥º", "í•­ìƒ í•¨ê»˜í• ê²Œ ì•½ì†! ğŸ¤", "ì˜¤ëŠ˜ë„ ê°™ì´ í˜ë‚´ì! ğŸ”¥",
        "ë„ˆë¬´ ì˜¤ë˜ë‘ë©´ ì™¸ë¡œìš¸ì§€ë„ ëª°ë¼ ğŸ˜­", "ê³ ë§ˆì›Œ! ğŸ¥°", "ê¸°ë¶„ ìµœê³ ì•¼! âœ¨", 
        "í—¤í—¤ ì¡°ì•„ ğŸ¾", "ë” ì“°ë‹¤ë“¬ì–´ì¤˜!", "ë§ë‘ë§ë‘í•´?", "í–‰ë³µí•´ ğŸ’•", 
        "ë„ˆë‘ ë…¸ëŠ”ê²Œ ì¢‹ì•„", "ê°„ì§€ëŸ¬ì›Œ ã…‹ã…‹", "ì¡°ê¸ˆ ë” ë§Œì ¸ì¤˜", "ì‚¬ë‘í•´! ğŸ˜"
      ];

      const handlePetTouch = () => {
        if (isLoading || !generatedImage || showReward || !isPetConfirmed) return; 
        
        const imgElement = petImgRef.current;
        if (!imgElement) return;

        imgElement.classList.remove('animate-squish');
        void imgElement.offsetWidth; 
        imgElement.classList.add('animate-squish');

        // [ìˆ˜ì • 1] í•˜íŠ¸ ì¢Œí‘œë¥¼ ì›í˜• ì»¨í…Œì´ë„ˆ ì•ˆì˜ ì ˆëŒ€ì ì¸ ìœ„ì¹˜ë¡œ ì„¤ì • (0%~100%)
        const newHeart = { 
            id: Date.now() + Math.random(), 
            // í« ì›í˜• ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ 20%~80% ì‚¬ì´ì˜ ëœë¤ ìœ„ì¹˜
            x: 20 + Math.random() * 60, // 20% to 80%
            y: 20 + Math.random() * 60, // 20% to 80%
            rotation: (Math.random() - 0.5) * 40,
            delay: Math.random() * 0.1 
        };
        
        // [ìˆ˜ì • 2] ê¸°ì¡´ í•˜íŠ¸ ìœ ì§€, ìƒˆ í•˜íŠ¸ ì¶”ê°€
        setHearts(prev => [...prev, newHeart]); 

        // 1.5ì´ˆ í›„ì— í•´ë‹¹ í•˜íŠ¸ë§Œ ì œê±° (setTimeout í™œìš©)
        setTimeout(() => {
           // í•˜íŠ¸ ë°°ì—´ì—ì„œ í•´ë‹¹ IDë¥¼ ê°€ì§„ í•˜íŠ¸ë§Œ í•„í„°ë§í•˜ì—¬ ì œê±°
           setHearts(prev => prev.filter(h => h.id !== newHeart.id));
        }, 1500);

        const now = Date.now();
        if (now - lastTouchTime.current < COUNT_DEBOUNCE_MS) {
            return; 
        }
        lastTouchTime.current = now; 

        const newTouchCount = touchCount + 1;
        setTouchCount(newTouchCount);

        if (newTouchCount < maxTouchCount) {
          if (newTouchCount % 4 === 0) {
            const randomIndex = Math.floor(Math.random() * randomMessages.length);
            setPetMessage(randomMessages[randomIndex]);
          }
        } else if (newTouchCount === maxTouchCount) {
          setPetMessage('ì„ ë¬¼ ì¤„ê²Œ! ë°›ì•„ê°€! ğŸ');
          setShowReward(true);
        }
      };

      const claimReward = () => {
        setShowCoin(true);
        setTimeout(() => {
            setTouchCount(0);
            setShowReward(false);
            setPetMessage('ê³ ë§ˆì›Œ! ë˜ ë†€ì ğŸ¤—');
            setPoints(prev => prev + 100);
        }, 800);
        setTimeout(() => {
            setShowCoin(false);
        }, 1600); 
        setHearts([]); 
      };
      
      const subHeaderText = isPetConfirmed 
        ? 'í«ì„ ë§ˆêµ¬ í„°ì¹˜í•´ì„œ ë³´ìƒì„ ë°›ì•„ë³´ì„¸ìš”!' 
        : 'ì‚¬ì§„ ë“±ë¡í•˜ê³  ë‚˜ë§Œì˜ í«ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!';
        
      
      let glowClass = 'shadow-inner-custom border-white/50';
      if (generatedImage && isPetConfirmed) {
          if (touchCount >= 12) {
              glowClass = 'shadow-[0_0_40px_rgba(250,204,21,0.9)] border-yellow-300 animate-pulse';
          } else if (touchCount >= 8) {
              glowClass = 'shadow-[0_0_30px_rgba(59,130,246,0.8)] border-blue-400';
          } else if (touchCount >= 4) {
              glowClass = 'shadow-[0_0_20px_rgba(96,165,250,0.6)] border-blue-200';
          }
      }


      return (
        <div className="app-container w-full max-w-[420px] bg-white shadow-lg min-h-screen flex flex-col relative select-none">
            
            {showCoin && (
                <div className="animate-coin-fly">
                    <div className="w-8 h-8 rounded-full bg-[#FFE54C] border-2 border-[#FFA000] flex items-center justify-center shadow-lg text-[#3E2723] font-bold">
                        P
                    </div>
                </div>
            )}

            {/* Top Bar */}
            <div className="p-4 flex items-center justify-between border-b border-gray-100 sticky top-0 bg-white z-10">
              <div className="flex items-center relative">
                <div className="w-8 h-8 flex items-center justify-center rounded-full bg-[#FFE54C] mr-2">
                  <span className="font-bold text-sm text-[#3E2723]">P</span>
                </div>
                <span className="font-bold text-lg transition-all duration-300">{points.toLocaleString()}P</span>
              </div>
              <div className="flex space-x-2 text-sm">
                <button className="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">ë‚´ì—­</button>
                <button className="px-3 py-1 bg-blue-500 text-white rounded-full text-sm">í¬ì¸íŠ¸ ì „í™˜</button>
              </div>
            </div>

            {/* Main Content */}
            <div className="flex-1 bg-gradient-to-b from-[#E3F2FD] to-white overflow-y-auto"> 
            
              <div className="p-4 text-center mt-4 relative">
                <h2 className="text-xl font-bold text-[#333] mb-2">
                  í†¡í†¡! ë‚˜ë§Œì˜ <span className="text-blue-600">í«</span>ê³¼ í•¨ê»˜í•˜ëŠ” ë¯¸ì…˜
                </h2>
                <p className="text-sm text-gray-600 mb-6">
                  {subHeaderText} 
                </p>
                
                {/* [ìˆ˜ì • ì‹œì‘] ë§í’ì„  ìœ„ì¹˜ ì¡°ì •: ì›í˜• ì»¨í…Œì´ë„ˆ ìœ„ë¡œ */}
                {generatedImage && isPetConfirmed && (
                  <div className={`
                    absolute top-[-30px] left-1/2 transform -translate-x-1/2 bg-white p-3 rounded-xl shadow-lg border-2 border-blue-400 z-35 transition-all duration-300 // Z-Index 35 (í•˜íŠ¸ ì•„ë˜, í« ìœ„)
                    ${showReward ? 'animate-bounce' : 'animate-scale-in'}
                  `} style={{ top: '100px' }} // í« ì›í˜• ê·¼ì²˜ë¡œ ê°•ì œ ë°°ì¹˜
                  >
                    <p className="text-sm font-medium text-gray-700 whitespace-nowrap">{petMessage}</p>
                    {showReward && (
                      <button
                        onClick={claimReward}
                        className="mt-2 w-full bg-yellow-400 hover:bg-yellow-500 text-gray-800 text-xs font-bold py-2 rounded-lg transition-all active:scale-95 whitespace-nowrap"
                      >
                        ê´‘ê³  ë³´ê³  ë³´ìƒ ë°›ê¸° (+100P)
                      </button>
                    )}
                    <div className="absolute bottom-[-10px] left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[10px] border-l-transparent border-r-[10px] border-r-transparent border-t-[10px] border-t-white"></div>
                  </div>
                )}
                {/* [ìˆ˜ì • ë] ë§í’ì„  ìœ„ì¹˜ ì¡°ì • */}


                {/* Pet Interaction Area */}
                <div 
                  className={`relative w-full aspect-square max-w-[300px] mx-auto rounded-full flex items-center justify-center cursor-pointer overflow-hidden p-4 border-4 transition-all duration-500 
                  bg-white ${glowClass}`} 
                  onClick={generatedImage && isPetConfirmed ? handlePetTouch : handlePetAreaClick}
                  style={{ WebkitTapHighlightColor: 'transparent' }} 
                >
                  {/* í•˜íŠ¸ ë Œë”ë§ */}
                  {isPetConfirmed && hearts.map(heart => (
                      <div 
                          key={heart.id} 
                          className="animate-heart-pop text-red-500 text-2xl"
                          style={{ 
                              position: 'absolute', // ì ˆëŒ€ ìœ„ì¹˜ ì„¤ì •
                              top: `${heart.y}%`, // y ì¢Œí‘œë¥¼ í¼ì„¼íŠ¸ë¡œ
                              left: `${heart.x}%`, // x ì¢Œí‘œë¥¼ í¼ì„¼íŠ¸ë¡œ
                              transform: `translate(-50%, -50%) rotate(${heart.rotation}deg)`,
                              animationDelay: `${heart.delay}s`,
                              animationDuration: '1.2s',
                              zIndex: 40 // í•˜íŠ¸ëŠ” Z-Index 40
                          }}
                      >
                          â¤ï¸
                      </div>
                  ))}
                  
                  {isLoading ? (
                    <div className="flex flex-col items-center justify-center text-blue-600">
                      <Icon name="loader-2" className="w-10 h-10 animate-spin" />
                      <span className="mt-2 text-sm font-semibold text-center whitespace-nowrap">í«ì— ì˜í˜¼ì„ ë¶ˆì–´ë„£ëŠ” ì¤‘</span>
                    </div>
                  ) : generatedImage ? (
                    <>
                      <img 
                        ref={petImgRef} 
                        src={generatedImage} 
                        alt="My Pet" 
                        className={`w-full h-full object-contain ${generatedImage ? 'animate-fade-in' : ''}`} 
                        style={{zIndex: 20}} // í«ì€ Z-Index 20
                      />
                    </>
                  ) : selectedImage ? (
                      <img 
                        src={selectedImage} 
                        alt="Selected Preview" 
                        className="w-full h-full object-contain animate-fade-in opacity-50"
                      />
                  ) : (
                    <div className="flex flex-col items-center justify-center text-blue-500">
                      <Icon name="upload" className="w-10 h-10 mb-2" />
                      <span className="text-sm font-medium">ë‚´ ì‚¬ì§„ìœ¼ë¡œ í« ë§Œë“¤ê¸°</span>
                      <span className="text-xs text-gray-500 mt-1">í„°ì¹˜í•˜ì—¬ ì´ë¯¸ì§€ ì„ íƒ</span>
                    </div>
                  )}
                  
                  <input 
                    type="file" 
                    ref={fileInputRef}
                    onChange={(e) => processFile(e.target.files[0])}
                    accept="image/*"
                    className="hidden"
                  />

                  {/* [ìˆ˜ì • ì™„ë£Œ]: ì‚¬ì§„ì´ ì„ íƒë˜ì–´ ìˆê³ , í™•ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©°, ë¡œë”© ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ë²„íŠ¼ì´ ë‚˜íƒ€ë‚¨ */}
                  {selectedImage && !isPetConfirmed && !isLoading && !generatedImage && (
                    <button 
                      onClick={(e) => { e.stopPropagation(); generateAIImage(); }}
                      className="absolute bottom-4 left-1/2 -translate-x-1/2 bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-full text-sm font-medium flex items-center gap-2 shadow-lg transition-all active:scale-95 z-10 whitespace-nowrap"
                    >
                      <Icon name="sparkles" className="w-4 h-4" /> í«ìœ¼ë¡œ ë³€í™˜í•˜ê¸°
                    </button>
                  )}
                </div>
                
                {generatedImage && isPetConfirmed && (
                    <button 
                      onClick={(e) => { e.stopPropagation(); setSelectedImage(null); setGeneratedImage(null); setError(''); setTouchCount(0); setPetMessage('ì•ˆë…•? ë‚˜ë‘ ë†€ì!'); setIsPetConfirmed(false); setHearts([]); }}
                      className="w-full max-w-[300px] mx-auto mt-6 bg-red-500 hover:bg-red-600 text-white px-5 py-3 rounded-xl font-bold transition-all active:scale-95 shadow-md whitespace-nowrap flex items-center justify-center gap-2"
                    >
                      <Icon name="trash-2" className="w-4 h-4" /> í« ë²„ë¦¬ê¸°
                    </button>
                )}


                {generatedImage && !isPetConfirmed && !isLoading && (
                    <div className="mt-6 w-full max-w-[300px] mx-auto flex flex-col gap-2 z-20"> 
                        <button 
                          onClick={handleConfirmPet}
                          className="w-full bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-xl font-bold transition-all active:scale-95 shadow-lg whitespace-nowrap"
                        >
                            <Icon name="check-circle" className="w-4 h-4 mr-2 inline-block"/> ì´ëŒ€ë¡œ í™•ì •í•˜ê¸°
                        </button>
                        <button 
                          onClick={handleRerollPet}
                          className="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 px-5 py-3 rounded-xl font-bold transition-all active:scale-95 shadow-md whitespace-nowrap"
                        >
                            <Icon name="monitor-play" className="w-4 h-4 mr-2 inline-block"/> ê´‘ê³  ë³´ê³  ë‹¤ì‹œ ë§Œë“¤ê¸°
                        </button>
                    </div>
                )}
                
                {error && (
                  <div className="p-3 bg-red-100 border border-red-300 rounded-lg text-red-700 text-sm mt-6 mx-auto animate-pulse flex flex-col gap-1 max-w-[300px]">
                    <span className="font-bold">âš ï¸ ì˜¤ë¥˜ ë°œìƒ</span>
                    <span>{error}</span>
                  </div>
                )}
              </div>

              {/* Mission Lists */}
              <div className="mt-8 px-4 pb-4"> 
                <h3 className="font-bold text-lg text-[#333] mb-4">ê¸°ê°„ í•œì • ë¯¸ì…˜</h3>
                
                <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-3 flex items-center">
                  <div className="w-10 h-10 rounded-lg mr-3 bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center text-gray-500">
                      <Icon name="gamepad-2" className="w-5 h-5 opacity-50" />
                  </div>
                  <div className="flex-1">
                    <p className="font-medium text-base">[ì˜¤í”ˆí•˜ê¸°] ì¹´ë°œRED</p>
                    <p className="text-xs text-gray-500">ìµœì´ˆ ì˜¤í”ˆí•˜ë©´</p>
                  </div>
                  <span className="text-blue-600 font-bold flex items-center">
                    <Icon name="sparkles" className="w-4 h-4 mr-1 text-blue-400"/> 144
                  </span>
                </div>

                <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-3 flex items-center">
                  <div className="w-10 h-10 rounded-lg mr-3 bg-yellow-100 flex items-center justify-center text-yellow-500">
                      <Icon name="hand" className="w-5 h-5" />
                  </div>
                  <div className="flex-1">
                    <p className="font-medium text-base">ê°€ìœ„ë°”ìœ„ë³´ ì±Œë¦°ì§€</p>
                    <p className="text-xs text-gray-500">ì´ê¸¸ìˆ˜ë¡ ì»¤ì§€ëŠ” ë³´ìƒ</p>
                  </div>
                  <span className="text-blue-600 font-bold text-sm">
                    ìµœëŒ€ 100P
                  </span>
                </div>

                <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-3 flex items-center">
                  <div className="w-10 h-10 rounded-lg mr-3 bg-purple-100 flex items-center justify-center text-purple-500">
                      <Icon name="calendar" className="w-5 h-5" />
                  </div>
                  <div className="flex-1">
                    <p className="font-medium text-base">ì¶œì„ ì²´í¬</p>
                    <p className="text-xs text-gray-500">ëˆ„êµ¬ë‚˜ 1Pì— ë³´ë„ˆìŠ¤ê¹Œì§€</p>
                  </div>
                  <span className="text-blue-600 font-bold text-sm">
                    ìµœëŒ€ 11P
                  </span>
                </div>

                <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-3 flex items-center">
                  <div className="w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center mr-3">
                      <Icon name="users" className="w-5 h-5 text-red-500"/>
                  </div>
                  <div className="flex-1">
                    <p className="font-medium text-base">ë” ì»¤ì§„ ì¹œêµ¬ ì´ˆëŒ€</p>
                    <p className="text-xs text-gray-500">ê°€ì… ë³´ìƒì— í™œë™ ë³´ë„ˆìŠ¤ê¹Œì§€!</p>
                  </div>
                  <span className="text-blue-600 font-bold flex items-center">
                    <Icon name="sparkles" className="w-4 h-4 mr-1 text-blue-400"/> 500P
                  </span>
                </div>
              </div>


              {/* ê°„ë‹¨ í´ë¦­ ë¯¸ì…˜ (New Section) */}
              <div className="px-4 pb-4"> 
                <h3 className="font-bold text-lg text-[#333] mb-4">ê°„ë‹¨ í´ë¦­ ë¯¸ì…˜</h3>

                <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-3 flex items-center justify-between">
                  <div className="flex items-center">
                    <div className="w-10 h-10 rounded-lg mr-3 bg-red-100 flex items-center justify-center text-red-500">
                        <Icon name="gift" className="w-5 h-5"/>
                    </div>
                    <div>
                      <p className="font-medium text-base">ì˜¤ëŠ˜ì˜ ì„ ë¬¼ìƒì</p>
                      <p className="text-xs text-gray-500">5ì¼ ì—°ì† ì—´ë©´ ì¶”ê°€ ë³´ë„ˆìŠ¤</p>
                    </div>
                  </div>
                  <button className="px-3 py-1 bg-blue-100 text-blue-600 rounded-lg text-sm font-medium transition-colors active:scale-95">
                    ë°›ê¸°
                  </button>
                </div>
                
                <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-3 flex items-center justify-between">
                  <div className="flex items-center">
                    <div className="w-10 h-10 rounded-lg mr-3 bg-red-100 flex items-center justify-center text-red-500">
                        <Icon name="timer" className="w-5 h-5"/>
                    </div>
                    <div>
                      <p className="font-medium text-base">3ì´ˆë§Œì— í¬ì¸íŠ¸ ë°›ê¸°</p>
                      <p className="text-xs text-gray-500">ë²„íŠ¼ë§Œ ëˆŒëŸ¬ë„ ì ë¦½</p>
                    </div>
                  </div>
                  <span className="text-blue-600 font-bold text-sm">
                    10P
                  </span>
                </div>
                
                <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-3 flex items-center justify-between">
                  <div className="flex items-center">
                    <div className="w-10 h-10 rounded-lg mr-3 bg-yellow-100 flex items-center justify-center text-yellow-600">
                        <Icon name="coins" className="w-5 h-5"/>
                    </div>
                    <div>
                      <p className="font-medium text-base">í¬ì¸íŠ¸ ëª¨ìœ¼ê¸°+</p>
                      <p className="text-xs text-gray-500">ìµœëŒ€ 19,397,012P</p>
                    </div>
                  </div>
                   <button className="px-3 py-1 bg-blue-100 text-blue-600 rounded-lg text-sm font-medium transition-colors active:scale-95">
                    ë°›ê¸°
                  </button>
                </div>

              </div>

            </div>
            
            {/* Bottom Nav */}
            <div className="h-16 bg-white border-t border-gray-100 flex justify-around items-center z-10">
              <button className="flex flex-col items-center text-gray-400 hover:text-blue-600">
                <Icon name="search" className="w-5 h-5" />
                <span className="text-xs mt-1">ê²€ìƒ‰</span>
              </button>
              <button className="flex flex-col items-center text-gray-400 hover:text-blue-600">
                <Icon name="zap" className="w-5 h-5" />
                <span className="text-xs mt-1">ì´ìŠˆ</span>
              </button>
              <button className="flex flex-col items-center text-blue-600">
                <Icon name="gift" className="w-5 h-5" />
                <span className="text-xs mt-1">í˜œíƒ</span>
              </button>
              <button className="flex flex-col items-center text-gray-400 hover:text-blue-600">
                <Icon name="more-horizontal" className="w-5 h-5" />
                <span className="text-xs mt-1">ë”ë³´ê¸°</span>
              </button>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
  </script>
</body>
</html>
